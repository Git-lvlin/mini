<wxs module="tools" src="../../wxs/common.wxs" />

<view
  class="container"
  bindtouchmove="handleTouchMove"
  bindtouchend="handleTouchEnd"
>
  <!-- 导航栏地址 -->
  <view class="flex_fix nav_content" style="padding-top: {{$.systemInfo.statusHeight}}rpx;height:{{navigationBarHeight}}rpx">
    <view id="nav_body_id" class="nav_body" style="padding-top: {{$.systemInfo.statusHeight}}rpx;{{headBackCss}};height:{{navigationBarHeight}}rpx">
      <view class="nav_location">
        <image class="location_icon" src="{{tools.getImgUrl('miniprogram/home/location.png')}}" />
        <view class="flex_middle address" bindtap="onToLocation">
          <view class="location_address text_one_line">{{takeSpot.address || '选择自提点' }}</view>
          <view
            class="flex_fix store_name"
            wx:if="{{takeSpot.address && takeSpot.storeName }}"
          >{{takeSpot.storeName}}</view>
        </view>
        <image class="right_icon" src="{{tools.getImgUrl('miniprogram/common/triangle_bottom.png')}}" />
      </view>
      <view id="top_search" class="search_content" style="">
        <view class="search_body" bindtap="onToSearch">
          <image class="search_icon" src="{{tools.getImgUrl('miniprogram/home/search.png')}}" />
          <view class="search_text">请输入商品名称</view>
          <view class="search_btn">搜索</view>
        </view>
      </view>
    </view>
  </view>


  <scroll-view
    class="home_content"
    scroll-y
    scroll-top="{{scrollTop}}"
    refresher-enabled
    refresher-default-style="none"
    refresher-triggered="{{refresherTriggered}}"
    bindrefresherrefresh="onPullDownRefresh"
    bindscroll="onViewScroll"
  >
    <!-- 加载gif -->
    <image
      class="pul_icon"
      wx:if="{{showLoadImg}}"
      src="{{tools.getImgUrl('miniprogram/home/homeloading.gif')}}"
    />
    <block
      wx:for="{{floor.floors}}"
      wx:key="floorId"
    >

      <!-- 约购商品 -->
      <appointment
        moreRouter="intensive"
        floor="{{item}}"
        wx:if="{{item.floorType === 1}}"
      />

      <!-- 优惠券 -->
      <coupon
        floor="{{item}}"
        wx:if="{{item.floorType === 2}}"
      />

      <!-- 比价模块 -->
      <!-- <priceRatio
        floor="{{item}}"
        wx:if="{{item.floorType === 9}}"
      /> -->

      <!-- 快讯 -->
      <!-- <message
        floor="{{item}}"
        wx:if="{{item.floorType === 5}}"
      /> -->

      <!-- 豆腐块 -->
      <beancurd-cube
        floor="{{item}}"
        wx:if="{{item.floorType === 3}}"
      />

      <!-- banner 轮播 -->
      <banner
        floor="{{item}}"
        wx:if="{{item.floorType === 4}}"
      />

      <!-- 秒杀 -->
      <seckill
        floor="{{item}}"
        wx:if="{{item.floorType === 6}}"
      />

      <!-- 会员 / 店主专享 -->
      <!-- <vipgood
        floor="{{item}}"
        wx:if="{{item.floorType === 7}}"
      /> -->

      <!-- 热销商品 -->
      <!-- <view id="hotGoods"
        wx:if="{{item.floorType === 8}}"
      >
        <hotgoods
          scrollBottom="{{scrollBottom}}"
          floor="{{item}}"
        />
      </view> -->

      <!-- 分类商品 -->
      <!-- topSearchHeight="{{navigationBarHeight}}" -->
      <view id="classGoods"
        wx:if="{{item.floorType === 11}}"
      >
        <classgoods
          scrollBottom="{{scrollBottom}}"
          floor="{{item}}"
          isFixedTop="{{isFixedTop}}"
          bind:setScroll="setScroll"
          bind:setIsTop="setIsFixedTop"
        />
      </view>
    </block>
  </scroll-view>

  <!-- 固定位 tools.getImgUrl('miniprogram/home/receive_coupon.gif') -->
  <!-- ((!isOnGoods && scrolling) || isOnGoods) -->
  <view
    class="fixation {{scrolling ? 'fixation_action' : ''}}"
    wx:if="{{!!floor.bannerFloat.image}}"
  >
    <image
      id="fixation"
      class="fixation_img"
      data-url="{{floor.bannerFloat.actionUrl}}"
      src="{{!!floor.bannerFloat.image ? floor.bannerFloat.image : floor.bannerFloattools.getImgUrl('miniprogram/home/receive_coupon.gif')}}"
      bindtap="onFixation"
    />
  </view>

  <!-- 活动弹窗 -->
  <advert-popup advert="{{activityAdvert}}" />

  <!-- 底部占位 -->
  <view class="flex_fix bar_height" />
</view>
