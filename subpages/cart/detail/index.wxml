<wxs module="tools" src="../../../wxs/common.wxs" />

<view class="container">
  <view class="banner_content">
    <image
      class="back_icon"
      style="top: {{backTopHeight}}rpx"
      src="{{tools.getImgUrl('miniprogram/cart/good_back.png')}}"
      bindtap="onToBack"
    />
    <view class="user_banner_list" style="top: {{backTopHeight + 96}}rpx">
      <user-banner />
    </view>
    <swiper
      class="banner"
      indicator-dots="{{true}}"
      circular
      indicator-dots="{{false}}"
      autoplay="{{true}}"
      interval="{{3000}}"
      duration="{{600}}"
      bindanimationfinish="handleSwiperChange"
    >
      <block wx:for="{{good.imageList}}" wx:key="index">
        <swiper-item class="banner_item">
          <van-image
            width="750rpx"
            height="750rpx"
            fit="cover"
            src="{{item}}"
          />
        </swiper-item>
      </block>
    </swiper>
    <view class="swiper_num">{{swiperCurrent}}/{{!!good.imageList ? good.imageList.length : 1}}</view>
  </view>

  <!-- 商品标题模块 -->
  <view class="good_head">
    <view class="good_price" wx:if="{{isActivityGood == 1 || isActivityGood == 2}}">
      <view class="price">
        ￥<text class="max_text">{{tools.getPriceSplit(good.goodsSaleMinPrice)}}</text>{{tools.getPriceSplit(good.goodsSaleMinPrice, 1)}}
        <view class="market_price ">￥{{good.goodsMarketPrice}}</view>
      </view>
      <!-- <view class="sales">月售188件</view> -->
      <view class="sales">{{good.goodsSaleNum}}</view>
    </view>
    <view class="good_info">
      <view class="good_title">
        <view class="text text_one_line">{{good.goodsName}}</view>
        <view class="text_one_line">{{good.goodsDesc}}</view>
      </view>
      <view
        class="store_show_sale"
        wx:if="{{isActivityGood == 15 || isActivityGood == 3 || isActivityGood == 4}}"
      >{{good.goodsSaleNum}}</view>
      <view class="add_cart" wx:if="{{isActivityGood == 1 || isActivityGood == 2}}">
       <!-- || quantity && good.isMultiSpec == 1  -->
        <view class="cart_btn" wx:if="{{!quantity}}" bindtap="addCart">加入购物车</view>
        <view class="num_controller" wx:else>
          <image
            class="icon"
            src="{{tools.getImgUrl('miniprogram/cart/reduce%402x.png')}}"
            bindtap="reduceCart"
          />
          <!-- <input
            class="num_input"
            value="{{stock}}"
            wx:if="{{stock}}"
          /> -->
          <view class="num_input" >{{quantity}}</view>
          <image
            class="icon"
            src="{{tools.getImgUrl('miniprogram/cart/add%402x.png')}}"
            bindtap="addCart"
          />
        </view>
      </view>
    </view>
    <view class="store_price" wx:if="{{isActivityGood == 15 || isActivityGood == 3 || isActivityGood == 4}}">
      <view class="store_price_title">{{isActivityGood == 15 ? '集约价' : '' }}{{isActivityGood == 3 ? '单约价' : '' }}：</view>
      <price-mobel
        money="{{good.activityPrice != undefined ? good.activityPrice : good.goodsSaleMinPrice}}"
        marketMoney="{{good.goodsMarketPrice}}"
        desc="{{isActivityGood == 15 ? '集约价：' : '' }}{{isActivityGood == 3 ? '市场价：' : '' }}"
        minSize="{{28}}"
        maxSize="{{48}}"
      />
    </view>
  </view>

  <!-- <view class="space_20" />

  <view class="info_card">
    <view class="info_title">商品参数</view>
    <view class="parameter_list">
      <view
        class="parameter_item"
        wx:for="{{parameterList}}"
        wx:key="name"
      >
        <view class="parameter_name">{{item.name}}</view>
        <view class="parameter_value">{{item.value}}</view>
      </view>
    </view>
  </view> -->

  <view class="space_20" wx:if="{{isActivityGood == 15}}" />
  
  <!-- 提货地址 -->
  <view class="pick_info" wx:if="{{isActivityGood == 15}}" >
    <view class="pick_info_title">提货信息</view>
    <view class="pick_info_location text_one_line">
      自提点：
      <image class="location_icon" src="{{tools.getImgUrl('miniprogram/common/detail_location.png')}}" />
      <text class="location_text">{{good.storeAdress.storeName}}</text>
    </view>
    <view class="pick_info_address text_one_line">{{good.storeAdress.fullAddress}}</view>
  </view>
  

  <block wx:if="{{isActivityGood == 3 || isActivityGood == 4}}">
    <view class="space_20" />
    <view class="buy_together" wx:if="{{personalList.length}}">
      <view class="together_head">
        <view class="together_title">{{personalList.length}}人正在拼单，立即参与</view>
        <view class="together_more" bindtap="onOpenTeam">查看全部<image class="right_icon" src="{{tools.getImgUrl('miniprogram/common/right_jump.png')}}" /></view>
      </view>
      <block
        wx:for="{{personalList}}"
        wx:key="groupId"
      >
        <together-item
          data="{{item}}"
          bind:toBuy="onOpenTogether"
        />
      </block>
    </view>
  </block>

  <view class="space_20" />

  <view class="info_card">
    <view class="info_title">商品详情</view>
    <view class="detail">
      <van-image
        width="100%"
        fit="widthFix"
        custom-class="detail_image"
        wx:for="{{detailImg}}"
        wx:key="index"
        src="{{item}}"
      />
    </view>
  </view>

  <!-- 底部bar 占位 -->
  <view style="height: {{$.systemInfo.bottomBarHeight + 104}}rpx" />

  <!-- 选择规格 -->
  <!-- <spec-panel
    good="{{good}}"
  /> -->

  <!-- 集约商品 -->
  <view class="to_buy" wx:if="{{isActivityGood == 15}}">
    <view class="to_buy_btn" bindtap="onToCreate">立即购买</view>
  </view>

  <!-- 普通商品结算 -->
  <view wx:if="{{isActivityGood == 1 || isActivityGood == 2}}">
    <settlement-bar />
  </view>

  <!-- 拼团商品提交 -->
  <view class="bar_over_height" />
  <view class="together_bar" wx:if="{{personalList.length}}">
    <view class="flex_middle together_recommend" >
      <view class="user_avatar">
        <van-image
          width="48rpx"
          height="48rpx"
          fit="cover"
          src="{{personalList[0].icon}}"
        />
      </view>
      <view class="together_num">还差{{personalList[0].distanceNum}}人拼成</view>
      <count-down
        time="{{ tools.getLastTime(personalList[0].endTime) }}"
        isFull
      />
      <view
        data-data="{{personalList[0]}}"
        class="together_btn"
        bindtap="onOpenTogether"
      >去拼单<view class="right_arrow"/></view>
    </view>
    <view class="flex_middle together_order_btn">
      <view
        class="flex_center order_btn_item"
        data-type="alone"
        bindtap="onToCreate"
      >
        <view class="mar_price">￥{{good.goodsSaleMinPrice}}</view>
        <view class="mar_price">单独购买</view>
      </view>
      <view
        class="flex_center order_btn_item together_buy_btn"
        data-data="{{personalList[0]}}"
        bindtap="onOpenTogether"
      >
        <view class="mar_price">￥{{good.activityPrice}}</view>
        <view class="mar_price" >发起拼单</view>
      </view>
    </view>
  </view>

  <!-- 可拼团列表 -->
  <team-popup
    list="{{togetherList}}"
    show="{{showTeamPopup}}"
    bind:close="handleCloseTeamPopup"
    bind:toBuy="onOpenTogether"
  />

  <!-- 拼单详情弹窗 -->
  <together-popup
    data="{{teamDetail}}"
    show="{{showTogetherPopup}}"
    bind:close="handleCloseTogetherPopup"
    bind:jump="onToCreate"
  />
</view>